[gd_scene load_steps=18 format=2]

[ext_resource path="res://PathFollow.gd" type="Script" id=1]
[ext_resource path="res://assets/images/straight.png" type="Texture" id=2]
[ext_resource path="res://Player.gd" type="Script" id=3]
[ext_resource path="res://assets/images/sky-box.png" type="Texture" id=4]
[ext_resource path="res://assets/images/TexturesCom_Roads0069_1_seamless_S.jpg" type="Texture" id=5]
[ext_resource path="res://assets/images/grain.png" type="Texture" id=6]

[sub_resource type="PanoramaSky" id=9]
panorama = ExtResource( 4 )

[sub_resource type="Environment" id=10]
background_mode = 2
background_sky = SubResource( 9 )
ambient_light_color = Color( 1, 1, 1, 1 )
ambient_light_sky_contribution = 0.0
fog_depth_begin = 0.0
fog_depth_end = 18.9
glow_intensity = 3.1
glow_strength = 1.11
glow_bloom = 0.45

[sub_resource type="Curve3D" id=11]
_data = {
"points": PoolVector3Array( 11.2301, 0, -21.5497, -11.2301, 0, 21.5497, -63.8448, -0.00358265, -43.1412, -7.28441, 0, -17.9075, 7.28441, 0, 17.9075, -57.3648, 0, 46.2864, 0, 0, 0, 0, 0, 0, -38.2836, 0, 63.5731, 2.23553, 0, 17.6049, -2.23553, 0, -17.6049, -25.7087, 0, 46.2477, -4.50632, 0, 12.9928, 4.50632, 0, -12.9928, -31.2623, 0, 22.9156, -11.1631, 0, -2.46855, 11.1631, 0, 2.46855, 3.33871, 0, 13.5065, -17.6659, 0, -0.39468, 17.6659, 0, 0.39468, 32.4764, 0, 57.8201, -3.66373, 0, 7.56299, 3.66373, 0, -7.56299, 56.7578, 0, 24.4332, 3.69379, 0, 9.39615, -3.69379, 0, -9.39615, 66.1668, 0, -26.8613, 14.3306, 0, -4.06609, -14.3306, 0, 4.06609, 41.2784, 0, -43.8583, 7.89145, 0, -3.33869, -7.89145, 0, 3.33869, 18.5146, 0, -18.0593, 6.6774, 0, 6.07035, -6.6774, 0, -6.07035, -9.56447, 0, -22.9489, 10.0161, 0, 3.94573, -10.0161, 0, -3.94573, -35.8151, 0, -53.2673, 11.2301, 0, -21.5497, -11.2301, 0, 21.5497, -63.7387, 0, -43.2513 ),
"tilts": PoolRealArray( 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 )
}

[sub_resource type="Shader" id=12]
code = "shader_type spatial;

uniform sampler2D road_texture;

void fragment() {
	vec2 road_uv = vec2(UV.y, UV.x);
	
	vec4 color = texture(road_texture, road_uv);
	ALBEDO = color.rgb;
	METALLIC = 0.0;
	ROUGHNESS = 0.0;
}






"

[sub_resource type="ShaderMaterial" id=13]
shader = SubResource( 12 )
shader_param/road_texture = ExtResource( 5 )

[sub_resource type="QuadMesh" id=2]

[sub_resource type="SpatialMaterial" id=4]
params_use_alpha_scissor = true
params_alpha_scissor_threshold = 0.98
albedo_texture = ExtResource( 2 )

[sub_resource type="BoxShape" id=17]
extents = Vector3( 0.2, 0.5, 0.5 )

[sub_resource type="CapsuleShape" id=14]

[sub_resource type="QuadMesh" id=15]

[sub_resource type="SpatialMaterial" id=16]
flags_transparent = true
albedo_texture = ExtResource( 6 )

[node name="Spatial" type="Spatial"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource( 10 )

[node name="Track level 1" type="Spatial" parent="."]

[node name="Path" type="Path" parent="Track level 1"]
curve = SubResource( 11 )

[node name="CSGPolygon" type="CSGPolygon" parent="Track level 1/Path"]
snap = 0.0001
use_collision = true
polygon = PoolVector2Array( -5, 0, -5, 0.1, 5, 0.1, 5, 0 )
mode = 2
path_node = NodePath("..")
path_interval_type = 0
path_interval = 1.0
path_simplify_angle = 0.3
path_rotation = 2
path_local = false
path_continuous_u = true
path_u_distance = 1.0
path_joined = true
material = SubResource( 13 )

[node name="PathFollow" type="PathFollow" parent="Track level 1/Path"]
transform = Transform( 0.0757261, 5.28737e-06, 0.997129, -7.33272e-05, 1, 2.66161e-07, -0.997129, -7.31368e-05, 0.0757261, -63.8448, 0.996417, -43.1413 )
v_offset = 1.0
script = ExtResource( 1 )

[node name="Player" type="RigidBody" parent="Track level 1/Path/PathFollow"]
contact_monitor = true
axis_lock_angular_x = true
axis_lock_angular_z = true
linear_damp = 10.0
angular_damp = 10.0
script = ExtResource( 3 )

[node name="MeshInstance" type="MeshInstance" parent="Track level 1/Path/PathFollow/Player"]
transform = Transform( -4.37114e-08, 0, 1, 0, 0.74842, 0, -1, 0, -4.37114e-08, 0, 0.195406, 0 )
mesh = SubResource( 2 )
skeleton = NodePath("")
material/0 = SubResource( 4 )

[node name="CollisionShape" type="CollisionShape" parent="Track level 1/Path/PathFollow/Player"]
transform = Transform( 1, 0, -7.27596e-12, 0, -4.37112e-08, -1, 0, 1, -4.3708e-08, 0, 0.351932, 0 )
shape = SubResource( 17 )

[node name="Camera" type="Camera" parent="Track level 1/Path/PathFollow"]
transform = Transform( -5.96046e-08, -2.18279e-11, 1, 0, 1, 4.00178e-11, -1, 3.45608e-11, -5.96046e-08, 1.666, 1.285, 0.007 )
current = true
fov = 90.0
size = 5.0
far = 500.0

[node name="Grain" type="StaticBody" parent="Track level 1"]
transform = Transform( -0.000279126, 0.000105002, -1, 0.00101229, 0.999999, 0.00010472, 0.999999, -0.00101226, -0.000279232, -1.076, 0.5, 11.223 )

[node name="CollisionShape" type="CollisionShape" parent="Track level 1/Grain"]
shape = SubResource( 14 )

[node name="MeshInstance" type="MeshInstance" parent="Track level 1/Grain"]
mesh = SubResource( 15 )
material/0 = SubResource( 16 )

[connection signal="body_entered" from="Track level 1/Path/PathFollow/Player" to="Track level 1/Path/PathFollow/Player" method="_on_Player_body_entered"]
